var benzAudioEngine=function(){"use strict";function t(t,e){e&&(v[t]=e)}function e(t){return v.hasOwnProperty(t)?v[t]:null}function n(t){v.hasOwnProperty(t)&&delete v[t]}function o(){return A.length?A.shift():w++}function r(t){A.push(t)}function i(t){var e=o();return T[e]=t,e}function u(t){return T.hasOwnProperty(t)?T[t]:null}function a(t){T.hasOwnProperty(t)&&(delete T[t],r(t))}function s(){return[].concat(g(T.values()))}var l=window.AudioContext||window.webkitAudioContext||window.mozAudioContext,f=null,c=void 0,h=void 0,d=!1,p=1;l&&(f=new l,c=f.createGain(),h=f.createDynamicsCompressor(),h.connect(c),c.connect(f.destination),c.gain.value=1,f.desNode=h,f.setGlobalVolume=function(t){d||(c.gain.value=t),p=t},f.getGlobalVolume=function(){return p},f.setGlobalMuted=function(t){d=t,c.gain.value=t?0:p},f.getGlobalMuted=function(){return d});var _=f,v={},y={save:t,load:e,release:n},b=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},m=function(){function t(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}return function(e,n,o){return n&&t(e.prototype,n),o&&t(e,o),e}}(),g=function(t){if(Array.isArray(t)){for(var e=0,n=Array(t.length);e<t.length;e++)n[e]=t[e];return n}return Array.from(t)},w=1,A=[],T={},L={save:i,load:u,release:a,getAll:s},O=function(){function t(e,n){b(this,t);var o=y.load(e);if(o)return o;this._src=e,this._buffer=n||_.createBuffer(1,1,22050),this._isLoaded=!!n,this._onLoadFuncQueue=[],y.save(e,this),this._isLoaded||this._load()}return m(t,[{key:"_load",value:function(){var t=new XMLHttpRequest;t.open("GET",this._src,!0),t.responseType="arraybuffer",t.onload=function(){_.decodeAudioData(t.response,function(t){this._buffer=t,this._isLoaded=!0;for(var e=0,n=this._onLoadFuncQueue.length;e<n;e++){var o=this._onLoadFuncQueue[e];"function"==typeof o&&o()}this._onLoadFuncQueue=[]}.bind(this),function(){this._isLoaded=!0;for(var t=0,e=this._onLoadFuncQueue.length;t<e;t++){var n=this._onLoadFuncQueue[t];"function"==typeof n&&n()}this._onLoadFuncQueue=[]}.bind(this))}.bind(this),t.send()}},{key:"onload",value:function(t){"function"==typeof t&&(this._isLoaded?t():this._onLoadFuncQueue.push(t))}},{key:"getBuffer",value:function(){return this._buffer}},{key:"createSprite",value:function(e,n,o){var r=o||"";if(!r){for(var i=1;y.load(this._src+"$"+i);)i++;r=this._src+"$"+i}return this.onload(function(){for(var o=this._buffer.sampleRate,i=Math.floor(o*e),u=Math.ceil(o*n),a=this._buffer.numberOfChannels,s=_.createBuffer(a,u-i,o),l=0;l<a;l++)for(var f=s.getChannelData(l),c=this._buffer.getChannelData(l),h=i,d=0;h<u;h++,d++)f[d]=c[h];new t(r,s)}.bind(this)),r}}]),t}(),G=function(){function t(e,n,o){b(this,t),this._bufferObj=y.load(e),this._id=0,this._startTime=0,this._playedTime=0,this._paused=!0,this._source=null,this._loopStart=n,this._loopEnd=o,this._bufferObj&&(this._id=L.save(this))}return m(t,[{key:"_createNode",value:function(){var t=this;if(this._bufferObj){var e=this._bufferObj.getBuffer();if(e){var n=_.createBufferSource();n.buffer=e,n.connect(_.desNode),n.onended=function(){t._paused||L.release(t._id)},this._loopEnd&&(n.loop=!0,n.loopStart=this._loopStart,n.loopEnd=this._loopEnd),this._source=n}}}},{key:"play",value:function(){return this._source&&!this._paused?this._id:(this._paused=!1,this._createNode(),this._source?(this._startTime=_.currentTime-this._playedTime,this._source.start?this._source.start(0,this._playedTime):this._source.noteGrainOn?this._source.noteGrainOn(0,this._playedTime):this._source.noteOn(0,this._playedTime),this._id):0)}},{key:"pause",value:function(){if(this._playedTime=_.currentTime-this._startTime,this._paused=!0,this._loopEnd)for(;this._playedTime>=this._loopEnd;)this._playedTime-=this._loopEnd-this._loopStart;this._source&&this._source.stop()}},{key:"stop",value:function(){this._paused=!1,this._source&&this._source.stop(),L.release(this._id)}}]),t}(),M=function(){},k={support:function(){return!1},load:M,unload:M,sprite:M,play:M,pause:M,stop:M,setVolume:M,setMuted:M,getMuted:function(){return!0},pauseAll:M,stopAll:M};return _&&(k={support:function(){return!0},load:function(t,e){t instanceof Array||(t=[t]);for(var n=0,o=void 0,r=0,i=t.length;r<i;r++)!function(r,i){o=new O(t[r]),o.onload(function(){++n>=i&&"function"==typeof e&&e()})}(r,i)},unload:function(t){t instanceof Array||(t=[t]);var e=!0,n=!1,o=void 0;try{for(var r,i=t[Symbol.iterator]();!(e=(r=i.next()).done);e=!0){var u=r.value;y.release(u)}}catch(t){n=!0,o=t}finally{try{!e&&i.return&&i.return()}finally{if(n)throw o}}},sprite:function(t,e){var n=y.load(t);for(var o in e)e.hasOwnProperty(o)&&n.createSprite(e[o][0],e[o][1],o)},play:function(t,e,n){return new G(t,e,n).play()},pause:function(t){var e=L.load(t);e&&e.pause()},resume:function(t){var e=L.load(t);e&&e.play()},stop:function(t){var e=L.load(t);e&&e.stop()},setVolume:function(t){_.setGlobalVolume(t)},getVolume:function(){return _.getGlobalVolume()},setMuted:function(t){_.setGlobalMuted(t)},getMuted:function(){return _.getGlobalMuted()},pauseAll:function(){var t=L.getAll(),e=!0,n=!1,o=void 0;try{for(var r,i=t[Symbol.iterator]();!(e=(r=i.next()).done);e=!0){var u=r.value;u&&u.pause()}}catch(t){n=!0,o=t}finally{try{!e&&i.return&&i.return()}finally{if(n)throw o}}},stopAll:function(){var t=L.getAll(),e=!0,n=!1,o=void 0;try{for(var r,i=t[Symbol.iterator]();!(e=(r=i.next()).done);e=!0){var u=r.value;u&&u.stop()}}catch(t){n=!0,o=t}finally{try{!e&&i.return&&i.return()}finally{if(n)throw o}}}}),k}();