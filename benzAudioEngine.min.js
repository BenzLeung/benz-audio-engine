var benzAudioEngine=function(){"use strict";function t(t,e){e&&(y[t]=e)}function e(t){return y.hasOwnProperty(t)?y[t]:null}function n(t){y.hasOwnProperty(t)&&delete y[t]}function o(){return A.length?A.shift():w++}function i(t){A.push(t)}function r(t){var e=o();return T.set(e,t),e}function u(t){return T.hasOwnProperty(t)?T[t]:null}function a(t){T.hasOwnProperty(t)&&(delete T[t],i(t))}function s(){return[].concat(g(T.values()))}var l=window.AudioContext||window.webkitAudioContext||window.mozAudioContext,f=null,c=void 0,d=void 0,h=!1,p=1;l&&(f=new l,c=f.createGain(),d=f.createDynamicsCompressor(),d.connect(c),c.connect(f.destination),c.gain.value=1,f.desNode=d,f.setGlobalVolume=function(t){h||(c.gain.value=t),p=t},f.getGlobalVolume=function(){return p},f.setGlobalMuted=function(t){h=t,c.gain.value=t?0:p},f.getGlobalMuted=function(){return h});var _=f,y={},v={save:t,load:e,release:n},b=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},m=function(){function t(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}return function(e,n,o){return n&&t(e.prototype,n),o&&t(e,o),e}}(),g=function(t){if(Array.isArray(t)){for(var e=0,n=Array(t.length);e<t.length;e++)n[e]=t[e];return n}return Array.from(t)},w=1,A=[],T={},L={save:r,load:u,release:a,getAll:s},G=function(){function t(e){b(this,t);var n=v.load(e);if(n)return n;this._src=e,this._buffer=_.createBuffer(1,1,11025),this._isLoaded=!1,this._onLoadFuncQueue=[],v.save(e,this),this._load()}return m(t,[{key:"_load",value:function(){var t=new XMLHttpRequest;t.open("GET",this._src,!0),t.responseType="arraybuffer",t.onload=function(){_.decodeAudioData(t.response,function(t){this._buffer=t,this._isLoaded=!0;for(var e=0,n=this._onLoadFuncQueue.length;e<n;e++){var o=this._onLoadFuncQueue[e];"function"==typeof o&&o()}this._onLoadFuncQueue=[]}.bind(this),function(){this._isLoaded=!0;for(var t=0,e=this._onLoadFuncQueue.length;t<e;t++){var n=this._onLoadFuncQueue[t];"function"==typeof n&&n()}this._onLoadFuncQueue=[]}.bind(this))}.bind(this),t.send()}},{key:"onload",value:function(t){"function"==typeof t&&(this._isLoaded?t():this._onLoadFuncQueue.push(t))}},{key:"getBuffer",value:function(){return this._buffer}}]),t}(),O=function(){function t(e,n,o){b(this,t),this._bufferObj=v.load(e),this._id=0,this._startTime=0,this._playedTime=0,this._paused=!0,this._source=null,this._loopStart=n,this._loopEnd=o,this._bufferObj&&(this._id=L.save(this))}return m(t,[{key:"_createNode",value:function(){var t=this;if(this._bufferObj){var e=this._bufferObj.getBuffer();if(e){var n=_.createBufferSource();n.buffer=e,n.connect(_.desNode),n.onended=function(){t._paused||L.release(t._id)},this._loopEnd&&(n.loop=!0,n.loopStart=this._loopStart,n.loopEnd=this._loopEnd),this._source=n}}}},{key:"play",value:function(){return this._source&&!this._paused?this._id:(this._paused=!1,this._createNode(),this._source?(this._startTime=_.currentTime-this._playedTime,this._source.start?this._source.start(0,this._playedTime):this._source.noteGrainOn?this._source.noteGrainOn(0,this._playedTime):this._source.noteOn(0,this._playedTime),this._id):0)}},{key:"pause",value:function(){if(this._playedTime=_.currentTime-this._startTime,this._paused=!0,this._loopEnd)for(;this._playedTime>=this._loopEnd;)this._playedTime-=this._loopEnd-this._loopStart;this._source&&this._source.stop()}},{key:"stop",value:function(){this._paused=!1,this._source&&this._source.stop(),L.release(this._id)}}]),t}(),E=function(){},k={support:function(){return!1},load:E,unload:E,play:E,pause:E,stop:E,setVolume:E,setMuted:E,getMuted:function(){return!0},pauseAll:E,stopAll:E};return _&&(k={support:function(){return!0},load:function(t,e){t instanceof Array||(t=[t]);for(var n=0,o=void 0,i=0,r=t.length;i<r;i++)!function(i,r){o=new G(t[i]),o.onload(function(){++n>=r&&"function"==typeof e&&e()})}(i,r)},unload:function(t){t instanceof Array||(t=[t]);var e=!0,n=!1,o=void 0;try{for(var i,r=t[Symbol.iterator]();!(e=(i=r.next()).done);e=!0){var u=i.value;v.release(u)}}catch(t){n=!0,o=t}finally{try{!e&&r.return&&r.return()}finally{if(n)throw o}}},play:function(t,e,n){return new O(t,e,n).play()},pause:function(t){var e=L.load(t);e&&e.pause()},resume:function(t){var e=L.load(t);e&&e.play()},stop:function(t){var e=L.load(t);e&&e.stop()},setVolume:function(t){_.setGlobalVolume(t)},getVolume:function(){return _.getGlobalVolume()},setMuted:function(t){_.setGlobalMuted(t)},getMuted:function(){return _.getGlobalMuted()},pauseAll:function(){var t=L.getAll(),e=!0,n=!1,o=void 0;try{for(var i,r=t[Symbol.iterator]();!(e=(i=r.next()).done);e=!0){var u=i.value;u&&u.pause()}}catch(t){n=!0,o=t}finally{try{!e&&r.return&&r.return()}finally{if(n)throw o}}},stopAll:function(){var t=L.getAll(),e=!0,n=!1,o=void 0;try{for(var i,r=t[Symbol.iterator]();!(e=(i=r.next()).done);e=!0){var u=i.value;u&&u.stop()}}catch(t){n=!0,o=t}finally{try{!e&&r.return&&r.return()}finally{if(n)throw o}}}}),k}();